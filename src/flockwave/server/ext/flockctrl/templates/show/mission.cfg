# This is a mission file generated by skybrush-server.
#
# The file is intended to be used in drone light shows, adapted to the situations
# that typically occur in a light show (e.g., longer desired RC failsame time).

[mission]
display_name={display_name}

[settings]
choreography_file=choreography.cfg

[prearm]

# Max takeoff placement inaccuracy [m]
takeoff_placement_tolerance=3

# Max relative altitude error [m]
relative_altitude_tolerance=5

[failsafe]

# Specifies a voltage level under which lowbat error is activated [V].
# Note that the low-level autopilot can have its own battery check.
#
# This is lower than the default setting (10.5V) because these flights are
# pre-programmed.
low_bat_voltage=10.2

# Number of seconds that we are allowed to fly without RC signal
rc_failsafe_time=600

# Maximum distance that we are allowed to fly from the takeoff position [m]
max_flying_range={max_flying_range:.2f}

# Maximum height that we are allowed to reach from the takeoff position [m]
max_flying_height={max_flying_height:.2f}

# Geofence settings
flyingzone_file=flyingzone.cfg
flyingzone=show

[xbee]

# Clock that is shown in the status packets for monitoring purposes
clock_in_status_packet=choreo

[rc]

# Enable pyro switch on channel 6. This is not done for normal missions, only
# for shows.
pyro_switch = 6 2 2

[lighting]

# Make sure that the bytecode player synchronizes to the choreography clock
bytecode_player.clock=choreo

# Allow the bytecode player only if we are in "waypoint" mode (i.e. playing
# the show). This ensures that the bytecode player is disabled if the user
# switches to another flight mode during the show (e.g., the drones are switched
# to the '"land" state); otherwise the bytecode player might keep on playing
# the light show and one might not see the drone continuously.
bytecode_player.only_when_algorithm_is=waypoint

[algorithm]

# Minimum altitude (AGL) above which the velocity control kicks in and we
# consider the takeoff as complete.
# TODO(ntamas): this was taken from the ITU show. We should pick sensible
# defaults and use those in the default flockctrl config file.
waypoint.minimum_altitude=5

# Preferred takeoff altitude that we try to take off to.
# TODO(ntamas): this was taken from the ITU show. We should pick sensible
# defaults and use those in the default flockctrl config file.
waypoint.altitude_setpoint={altitude_setpoint:.2f}

# TODO(ntamas): a sensible default should be chosen and used, we should not
# have to tweak this on a show-by-show basis
waypoint.vertical_interaction_range=5

# Carefree mode angles for all possibly used algorithms
# We use the orientation of the X axis of the show coordinate system. If this
# needs to be configured, there should be a way in the Skybrush show file to
# specify this.
waypoint.carefree_mode_angle={orientation}
emergency.carefree_mode_angle={orientation}
return_to_home.carefree_mode_angle={orientation}
landing.carefree_mode_angle={orientation}

# Don't allow the pilot to intervene with the RC in the roll/pitch
# angles or in the throttle. This is to ensure that the pilot can
# safely control other drones in "landing", "RTH" or "emergency"
# phases without affecting the ones that are flying in the show
waypoint.manual_override_rp=none
waypoint.manual_override_gas=none

# Drones should land when they have reached the last waypoint in their
# program instead of returning to home
waypoint.whats_next=land

# Switch off repulsion almost completely to ensure that we are following
# trajectories accurately
waypoint.v_rep=100
waypoint.r0_rep=4
waypoint.p_rep=1.5

# Switch off friction almost completely to ensure that we are following
# trajectories accurately
waypoint.v_frict=3
waypoint.r0_offset_frict=0
waypoint.p_frict=1

# Travelling speeds if not defined by individual waypoints.
waypoint.velocity_xy={velocity_xy:.2f}
waypoint.velocity_z={velocity_z:.2f}

# Velocity limits in the XY and Z directions. Z must be slightly less than what
# the autopilot allows (2.5 for Pixhawk)
# TODO(ntamas): these should be lifted up to the default settings of flockctrl.
# If it is safe to go with 8 m/sec in a show, it should be safe to do so by
# default. If it is not safe, why do we do this in a show? :)
waypoint.velocity_threshold_xy={max_velocity_xy:.2f}
waypoint.velocity_threshold_z={max_velocity_z:.2f}

# TODO(ntamas): altitude where the drone switches from guided descent to
# autopilot-based descent. A sensible default should be picked and used in the
# default flockctrl config, we should not have to alter this for every show.
landing.state_guided_min_alt=30

# TODO(ntamas): velocity to use in the emergency algorithm and its maximum allowed
# magnitude. There should be no need to tweak this all the time; a sensible
# default should be picked and used in the default flockctrl config.
emergency.velocity_xy=5
emergency.velocity_threshold=6

# Always start RTH at the current altitude; this is the best way to ensure that
# we do not collide with others most of the time.
emergency.rth_altitude = 0

# Always start RTH at the current altitude; this is the best way to ensure that
# we do not collide with others most of the time.
return_to_home.altitude_setpoint = 0

# TODO(ntamas): velocity to use in the RTH algorithm and its maximum allowed
# magnitude. There should be no need to tweak this all the time; a sensible
# default should be picked and used in the default flockctrl config.
return_to_home.velocity_xy=5
return_to_home.velocity_threshold=6
